/**********************************************************************************************************************
 * Author: Duffy
 * Description:
 * 
 * Version:
 *********************************************************************************************************************/

#ifndef XINDONGLIB_CV_H_
#define XINDONGLIB_CV_H_

/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/
#include "Camera.h"
#include "XinDong_Config.h"

/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/
#define CV_IMAGE_WIDTH      CAM_IMAGE_WIDTH
#define CV_IMAGE_HEIGHT     CAM_IMAGE_HEIGHT
#define CV_TARGET_Y         180  // 指定提取中点的纵轴位置
#define CV_SCAN_START_Y     150  // 补线判断的起始Y坐标
#define CV_SCAN_END_Y       170  // 补线判断的结束Y坐标

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/
extern int16 g_buxian;  // 补线方向判断变量

/*********************************************************************************************************************/
/*-------------------------------------------------Data Structures---------------------------------------------------*/
/*********************************************************************************************************************/
typedef struct {
    uint8* image_data;
    int16 error;
    uint8 valid;
} CV_Result_t;

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/
// 图像预处理：转换为二值化掩码
void CV_PreprocessImage(uint8 (*input_img)[CV_IMAGE_HEIGHT][CV_IMAGE_WIDTH], 
                       uint8 (*mask)[CV_IMAGE_HEIGHT][CV_IMAGE_WIDTH]);

// 中线检测主函数
CV_Result_t CV_DetectMidline(uint8 (*input_img)[CV_IMAGE_HEIGHT][CV_IMAGE_WIDTH]);

// 计算图像中线的偏差
int16 CV_CalculateMidlineError(uint8 (*follow)[CV_IMAGE_HEIGHT][CV_IMAGE_WIDTH], 
                              uint8 (*mask)[CV_IMAGE_HEIGHT][CV_IMAGE_WIDTH]);

// 图像处理主函数
CV_Result_t CV_ProcessImage(void);

#endif /* XINDONGLIB_CV_H_ */
