/**********************************************************************************************************************
 * Author: Yuhui Fu
 * Description: Motor, Servo, PID
 * 
 * Version:
 *********************************************************************************************************************/

#ifndef XINDONGLIB_MOVEMENTS_H_
#define XINDONGLIB_MOVEMENTS_H_

/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/
#include "Ifx_Types.h"
#include "IfxGtm_Tom_Pwm.h"

#include "XinDong_Config.h"
/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/
#define SERVO_FREQUENCY 50
#define SERVO_PERIOD 50000
#define SERVO_1MS_COUNT (SERVO_PERIOD / 1000 * SERVO_FREQUENCY)

#define MOTOR_FREQUENCY 32000
#define MOTOR_PERIOD 100
#define MOTOR_REVERSE FALSE
/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*-------------------------------------------------Data Structures---------------------------------------------------*/
/*********************************************************************************************************************/

extern struct PID {
    float target_speed;
    float current_speed;
    float error;
    float last_error;
    float kp, ki, kd;
    float integral;
} pid;

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/
void Servo_Init(void);

void Servo_Set(float angle);

void Motor_Init(void);

void Motor_Set(float power);

void PID_Init(float kp, float ki, float kd);

float PID_Output(float target_speed, float current_speed);

#endif /* XINDONGLIB_MOVEMENTS_H_ */
